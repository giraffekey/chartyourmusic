var Canvas2Image=function(){var t,e,n=(t=document.createElement("canvas"),{canvas:!!(e=t.getContext("2d")),imageData:!!e.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa});function r(t,e,n){var r=t.width,a=t.height;null==e&&(e=r),null==n&&(n=a);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e,o.height=n,i.drawImage(t,0,0,r,a,0,0,e,n),o}function a(t,e,n,a){return(t=r(t,n,a)).toDataURL(e)}function o(t){document.location.href=t}function i(t){var e=document.createElement("img");return e.src=t,e}function u(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function c(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function g(t){var e=t.width,n=t.height;return t.getContext("2d").getImageData(0,0,e,n)}function f(t,e){return"data:"+e+";base64,"+t}var m=function(t){var e=t.width,n=t.height,r=e*n*3,a=r+54,o=[66,77,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,54,0,0,0],i=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=(4-3*e%4)%4,g=t.data,f="",m=e<<2,v=n,d=String.fromCharCode;do{for(var s=m*(v-1),p="",h=0;h<e;h++){var l=h<<2;p+=d(g[s+l+2])+d(g[s+l+1])+d(g[s+l])}for(var b=0;b<u;b++)p+=String.fromCharCode(0);f+=p}while(--v);return c(o.concat(i))+c(f)},v=function(t,e,i,c){if(n.canvas&&n.dataURL)if("string"==typeof t&&(t=document.getElementById(t)),null==c&&(c="png"),c=u(c),/bmp/.test(c)){var v=g(r(t,e,i));o(f(m(v),"image/octet-stream"))}else{o(a(t,c,e,i).replace(c,"image/octet-stream"))}},d=function(t,e,o,c){if(n.canvas&&n.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==c&&(c="png"),c=u(c),/bmp/.test(c)){var v=g(r(t,e,o));return i(f(m(v),"image/bmp"))}return i(a(t,c,e,o))}};return{saveAsImage:v,saveAsPNG:function(t,e,n){return v(t,e,n,"png")},saveAsJPEG:function(t,e,n){return v(t,e,n,"jpeg")},saveAsGIF:function(t,e,n){return v(t,e,n,"gif")},saveAsBMP:function(t,e,n){return v(t,e,n,"bmp")},convertToImage:d,convertToPNG:function(t,e,n){return d(t,e,n,"png")},convertToJPEG:function(t,e,n){return d(t,e,n,"jpeg")},convertToGIF:function(t,e,n){return d(t,e,n,"gif")},convertToBMP:function(t,e,n){return d(t,e,n,"bmp")}}}();