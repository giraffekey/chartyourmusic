var Canvas2Image=function(){var t,e,n=(t=document.createElement("canvas"),{canvas:!!(e=t.getContext("2d")),imageData:!!e.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa});function a(t,e,n){var a=t.width,r=t.height;null==e&&(e=a),null==n&&(n=r);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e,o.height=n,i.drawImage(t,0,0,a,r,0,0,e,n),o}function r(t,e,n,r){return(t=a(t,n,r)).toDataURL(e)}function o(t,e){var n=document.createElement("a");n.download=t,n.href=e,n.click()}function i(t){var e=document.createElement("img");return e.src=t,e}function c(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function u(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function g(t){var e=t.width,n=t.height;return t.getContext("2d").getImageData(0,0,e,n)}function f(t,e){return"data:"+e+";base64,"+t}var m=function(t){var e=t.width,n=t.height,a=e*n*3,r=a+54,o=[66,77,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],i=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=(4-3*e%4)%4,g=t.data,f="",m=e<<2,v=n,d=String.fromCharCode;do{for(var s=m*(v-1),l="",p=0;p<e;p++){var h=p<<2;l+=d(g[s+h+2])+d(g[s+h+1])+d(g[s+h])}for(var w=0;w<c;w++)l+=String.fromCharCode(0);f+=l}while(--v);return u(o.concat(i))+u(f)},v=function(t,e,i,u,v){if(n.canvas&&n.dataURL)if("string"==typeof t&&(t=document.getElementById(t)),null==v&&(v="png"),"bmp"==v){var d=g(a(t,i,u));o(e+"."+v,f(m(d),"image/octet-stream"))}else{o(e+"."+v,r(t,c(v),i,u).replace(v,"image/octet-stream"))}},d=function(t,e,o,u){if(n.canvas&&n.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==u&&(u="png"),u=c(u),/bmp/.test(u)){var v=g(a(t,e,o));return i(f(m(v),"image/bmp"))}return i(r(t,u,e,o))}};return{saveAsImage:v,saveAsPNG:function(t,e,n,a){return v(t,e,n,a,"png")},saveAsJPEG:function(t,e,n,a){return v(t,e,n,a,"jpeg")},saveAsGIF:function(t,e,n,a){return v(t,e,n,a,"gif")},saveAsBMP:function(t,e,n,a){return v(t,e,n,a,"bmp")},convertToImage:d,convertToPNG:function(t,e,n){return d(t,e,n,"png")},convertToJPEG:function(t,e,n){return d(t,e,n,"jpeg")},convertToGIF:function(t,e,n){return d(t,e,n,"gif")},convertToBMP:function(t,e,n){return d(t,e,n,"bmp")}}}();